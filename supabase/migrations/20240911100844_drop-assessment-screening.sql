revoke delete on table "public"."assessment" from "anon";

revoke insert on table "public"."assessment" from "anon";

revoke references on table "public"."assessment" from "anon";

revoke select on table "public"."assessment" from "anon";

revoke trigger on table "public"."assessment" from "anon";

revoke truncate on table "public"."assessment" from "anon";

revoke update on table "public"."assessment" from "anon";

revoke delete on table "public"."assessment" from "authenticated";

revoke insert on table "public"."assessment" from "authenticated";

revoke references on table "public"."assessment" from "authenticated";

revoke select on table "public"."assessment" from "authenticated";

revoke trigger on table "public"."assessment" from "authenticated";

revoke truncate on table "public"."assessment" from "authenticated";

revoke update on table "public"."assessment" from "authenticated";

revoke delete on table "public"."assessment" from "service_role";

revoke insert on table "public"."assessment" from "service_role";

revoke references on table "public"."assessment" from "service_role";

revoke select on table "public"."assessment" from "service_role";

revoke trigger on table "public"."assessment" from "service_role";

revoke truncate on table "public"."assessment" from "service_role";

revoke update on table "public"."assessment" from "service_role";

revoke delete on table "public"."assessment_job_relation" from "anon";

revoke insert on table "public"."assessment_job_relation" from "anon";

revoke references on table "public"."assessment_job_relation" from "anon";

revoke select on table "public"."assessment_job_relation" from "anon";

revoke trigger on table "public"."assessment_job_relation" from "anon";

revoke truncate on table "public"."assessment_job_relation" from "anon";

revoke update on table "public"."assessment_job_relation" from "anon";

revoke delete on table "public"."assessment_job_relation" from "authenticated";

revoke insert on table "public"."assessment_job_relation" from "authenticated";

revoke references on table "public"."assessment_job_relation" from "authenticated";

revoke select on table "public"."assessment_job_relation" from "authenticated";

revoke trigger on table "public"."assessment_job_relation" from "authenticated";

revoke truncate on table "public"."assessment_job_relation" from "authenticated";

revoke update on table "public"."assessment_job_relation" from "authenticated";

revoke delete on table "public"."assessment_job_relation" from "service_role";

revoke insert on table "public"."assessment_job_relation" from "service_role";

revoke references on table "public"."assessment_job_relation" from "service_role";

revoke select on table "public"."assessment_job_relation" from "service_role";

revoke trigger on table "public"."assessment_job_relation" from "service_role";

revoke truncate on table "public"."assessment_job_relation" from "service_role";

revoke update on table "public"."assessment_job_relation" from "service_role";

revoke delete on table "public"."assessment_question" from "anon";

revoke insert on table "public"."assessment_question" from "anon";

revoke references on table "public"."assessment_question" from "anon";

revoke select on table "public"."assessment_question" from "anon";

revoke trigger on table "public"."assessment_question" from "anon";

revoke truncate on table "public"."assessment_question" from "anon";

revoke update on table "public"."assessment_question" from "anon";

revoke delete on table "public"."assessment_question" from "authenticated";

revoke insert on table "public"."assessment_question" from "authenticated";

revoke references on table "public"."assessment_question" from "authenticated";

revoke select on table "public"."assessment_question" from "authenticated";

revoke trigger on table "public"."assessment_question" from "authenticated";

revoke truncate on table "public"."assessment_question" from "authenticated";

revoke update on table "public"."assessment_question" from "authenticated";

revoke delete on table "public"."assessment_question" from "service_role";

revoke insert on table "public"."assessment_question" from "service_role";

revoke references on table "public"."assessment_question" from "service_role";

revoke select on table "public"."assessment_question" from "service_role";

revoke trigger on table "public"."assessment_question" from "service_role";

revoke truncate on table "public"."assessment_question" from "service_role";

revoke update on table "public"."assessment_question" from "service_role";

revoke delete on table "public"."assessment_results" from "anon";

revoke insert on table "public"."assessment_results" from "anon";

revoke references on table "public"."assessment_results" from "anon";

revoke select on table "public"."assessment_results" from "anon";

revoke trigger on table "public"."assessment_results" from "anon";

revoke truncate on table "public"."assessment_results" from "anon";

revoke update on table "public"."assessment_results" from "anon";

revoke delete on table "public"."assessment_results" from "authenticated";

revoke insert on table "public"."assessment_results" from "authenticated";

revoke references on table "public"."assessment_results" from "authenticated";

revoke select on table "public"."assessment_results" from "authenticated";

revoke trigger on table "public"."assessment_results" from "authenticated";

revoke truncate on table "public"."assessment_results" from "authenticated";

revoke update on table "public"."assessment_results" from "authenticated";

revoke delete on table "public"."assessment_results" from "service_role";

revoke insert on table "public"."assessment_results" from "service_role";

revoke references on table "public"."assessment_results" from "service_role";

revoke select on table "public"."assessment_results" from "service_role";

revoke trigger on table "public"."assessment_results" from "service_role";

revoke truncate on table "public"."assessment_results" from "service_role";

revoke update on table "public"."assessment_results" from "service_role";

revoke delete on table "public"."assessment_template" from "anon";

revoke insert on table "public"."assessment_template" from "anon";

revoke references on table "public"."assessment_template" from "anon";

revoke select on table "public"."assessment_template" from "anon";

revoke trigger on table "public"."assessment_template" from "anon";

revoke truncate on table "public"."assessment_template" from "anon";

revoke update on table "public"."assessment_template" from "anon";

revoke delete on table "public"."assessment_template" from "authenticated";

revoke insert on table "public"."assessment_template" from "authenticated";

revoke references on table "public"."assessment_template" from "authenticated";

revoke select on table "public"."assessment_template" from "authenticated";

revoke trigger on table "public"."assessment_template" from "authenticated";

revoke truncate on table "public"."assessment_template" from "authenticated";

revoke update on table "public"."assessment_template" from "authenticated";

revoke delete on table "public"."assessment_template" from "service_role";

revoke insert on table "public"."assessment_template" from "service_role";

revoke references on table "public"."assessment_template" from "service_role";

revoke select on table "public"."assessment_template" from "service_role";

revoke trigger on table "public"."assessment_template" from "service_role";

revoke truncate on table "public"."assessment_template" from "service_role";

revoke update on table "public"."assessment_template" from "service_role";

revoke delete on table "public"."screening_answers" from "anon";

revoke insert on table "public"."screening_answers" from "anon";

revoke references on table "public"."screening_answers" from "anon";

revoke select on table "public"."screening_answers" from "anon";

revoke trigger on table "public"."screening_answers" from "anon";

revoke truncate on table "public"."screening_answers" from "anon";

revoke update on table "public"."screening_answers" from "anon";

revoke delete on table "public"."screening_answers" from "authenticated";

revoke insert on table "public"."screening_answers" from "authenticated";

revoke references on table "public"."screening_answers" from "authenticated";

revoke select on table "public"."screening_answers" from "authenticated";

revoke trigger on table "public"."screening_answers" from "authenticated";

revoke truncate on table "public"."screening_answers" from "authenticated";

revoke update on table "public"."screening_answers" from "authenticated";

revoke delete on table "public"."screening_answers" from "service_role";

revoke insert on table "public"."screening_answers" from "service_role";

revoke references on table "public"."screening_answers" from "service_role";

revoke select on table "public"."screening_answers" from "service_role";

revoke trigger on table "public"."screening_answers" from "service_role";

revoke truncate on table "public"."screening_answers" from "service_role";

revoke update on table "public"."screening_answers" from "service_role";

revoke delete on table "public"."screening_questions" from "anon";

revoke insert on table "public"."screening_questions" from "anon";

revoke references on table "public"."screening_questions" from "anon";

revoke select on table "public"."screening_questions" from "anon";

revoke trigger on table "public"."screening_questions" from "anon";

revoke truncate on table "public"."screening_questions" from "anon";

revoke update on table "public"."screening_questions" from "anon";

revoke delete on table "public"."screening_questions" from "authenticated";

revoke insert on table "public"."screening_questions" from "authenticated";

revoke references on table "public"."screening_questions" from "authenticated";

revoke select on table "public"."screening_questions" from "authenticated";

revoke trigger on table "public"."screening_questions" from "authenticated";

revoke truncate on table "public"."screening_questions" from "authenticated";

revoke update on table "public"."screening_questions" from "authenticated";

revoke delete on table "public"."screening_questions" from "service_role";

revoke insert on table "public"."screening_questions" from "service_role";

revoke references on table "public"."screening_questions" from "service_role";

revoke select on table "public"."screening_questions" from "service_role";

revoke trigger on table "public"."screening_questions" from "service_role";

revoke truncate on table "public"."screening_questions" from "service_role";

revoke update on table "public"."screening_questions" from "service_role";

revoke delete on table "public"."template_question_relation" from "anon";

revoke insert on table "public"."template_question_relation" from "anon";

revoke references on table "public"."template_question_relation" from "anon";

revoke select on table "public"."template_question_relation" from "anon";

revoke trigger on table "public"."template_question_relation" from "anon";

revoke truncate on table "public"."template_question_relation" from "anon";

revoke update on table "public"."template_question_relation" from "anon";

revoke delete on table "public"."template_question_relation" from "authenticated";

revoke insert on table "public"."template_question_relation" from "authenticated";

revoke references on table "public"."template_question_relation" from "authenticated";

revoke select on table "public"."template_question_relation" from "authenticated";

revoke trigger on table "public"."template_question_relation" from "authenticated";

revoke truncate on table "public"."template_question_relation" from "authenticated";

revoke update on table "public"."template_question_relation" from "authenticated";

revoke delete on table "public"."template_question_relation" from "service_role";

revoke insert on table "public"."template_question_relation" from "service_role";

revoke references on table "public"."template_question_relation" from "service_role";

revoke select on table "public"."template_question_relation" from "service_role";

revoke trigger on table "public"."template_question_relation" from "service_role";

revoke truncate on table "public"."template_question_relation" from "service_role";

revoke update on table "public"."template_question_relation" from "service_role";

alter table "public"."applications" drop constraint "applications_assessment_id_fkey";

alter table "public"."assessment" drop constraint "assessment_recruiter_id_fkey";

alter table "public"."assessment_job_relation" drop constraint "assessment_job_relation_assessment_id_fkey";

alter table "public"."assessment_job_relation" drop constraint "assessment_job_relation_job_id_fkey";

alter table "public"."assessment_question" drop constraint "assessment_question_assessment_id_fkey";

alter table "public"."assessment_question" drop constraint "public_assessment_question_parent_question_id_fkey";

alter table "public"."assessment_results" drop constraint "assessment_results_application_id_fkey";

alter table "public"."assessment_results" drop constraint "public_assessment_results_assessment_id_fkey";

alter table "public"."public_jobs" drop constraint "public_public_jobs_screening_template_fkey";

alter table "public"."screening_answers" drop constraint "public_screening_answers_screening_id_fkey";

alter table "public"."screening_answers" drop constraint "screening_answers_id_key";

alter table "public"."screening_questions" drop constraint "public_screening_questions_recruiter_id_fkey";

alter table "public"."screening_questions" drop constraint "screening_questions_id_key";

alter table "public"."template_question_relation" drop constraint "template_question_relation_question_id_fkey";

alter table "public"."template_question_relation" drop constraint "template_question_relation_template_id_fkey";

drop function if exists "public"."connectassessmenttemplate"(assessmentid uuid, recruiterid uuid, templateid uuid, jobid uuid);

drop function if exists "public"."connectbulkassessmenttemplate"(assessments uuid[], recruiterid uuid, templates jsonb[], jobid uuid);

drop function if exists "public"."getassessments"(recruiterid uuid);

drop function if exists "public"."getassessmenttemplates"();

drop view if exists "public"."application_view";

drop view if exists "public"."candidate_applications_view";

drop view if exists "public"."job_view";

drop view if exists "public"."meeting_details";

drop view if exists "public"."tasks_view";

drop view if exists "public"."workflow_view";

drop view if exists "public"."application_status_view";

drop view if exists "public"."meeting_interviewers";

alter table "public"."assessment" drop constraint "assessment_pkey";

alter table "public"."assessment_job_relation" drop constraint "assessment_job_relation_pkey";

alter table "public"."assessment_question" drop constraint "assessment_question_pkey";

alter table "public"."assessment_results" drop constraint "new_assessment_results_pkey";

alter table "public"."assessment_template" drop constraint "assessment_template_pkey";

alter table "public"."screening_answers" drop constraint "screening_answers_pkey";

alter table "public"."screening_questions" drop constraint "screening_questions_pkey";

alter table "public"."template_question_relation" drop constraint "template_question_relation_pkey";

drop index if exists "public"."assessment_job_relation_pkey";

drop index if exists "public"."assessment_pkey";

drop index if exists "public"."assessment_question_pkey";

drop index if exists "public"."assessment_template_pkey";

drop index if exists "public"."new_assessment_results_pkey";

drop index if exists "public"."screening_answers_id_key";

drop index if exists "public"."screening_answers_pkey";

drop index if exists "public"."screening_questions_id_key";

drop index if exists "public"."screening_questions_pkey";

drop index if exists "public"."template_question_relation_pkey";

drop table "public"."assessment";

drop table "public"."assessment_job_relation";

drop table "public"."assessment_question";

drop table "public"."assessment_results";

drop table "public"."assessment_template";

drop table "public"."screening_answers";

drop table "public"."screening_questions";

drop table "public"."template_question_relation";

alter table "public"."applications" drop column "assessment_id";

alter table "public"."public_jobs" drop column "phone_screening";

alter table "public"."public_jobs" drop column "screening_questions";

alter table "public"."public_jobs" drop column "screening_template";

create or replace view "public"."application_status_view" as  WITH processing_state_cte AS (
         SELECT applications.id,
            applications.job_id,
            applications.created_at,
            applications.applied_at,
            applications.overall_interview_score AS interview_score,
            applications.processing_status,
            applications.bookmarked,
            applications.is_new,
            applications.status,
            (applications.score_json -> 'badges'::text) AS badges,
            applications.candidate_id,
            applications.candidate_file_id,
            candidate_files.file_url,
                CASE
                    WHEN (applications.is_resume_fetching = true) THEN 'fetching'::resume_processing_state
                    WHEN (candidate_files.file_url IS NULL) THEN 'unavailable'::resume_processing_state
                    WHEN ((applications.processing_status = 'not started'::application_processing_status) OR (applications.processing_status = 'processing'::application_processing_status)) THEN 'processing'::resume_processing_state
                    WHEN ((applications.score_json -> 'scores'::text) IS NOT NULL) THEN 'processed'::resume_processing_state
                    ELSE 'unparsable'::resume_processing_state
                END AS resume_processing_state,
            (applications.score_json -> 'scores'::text) AS scores
           FROM (applications
             LEFT JOIN candidate_files ON ((candidate_files.id = applications.candidate_file_id)))
        ), resume_processing_state AS (
         SELECT processing_state_cte.id,
            processing_state_cte.job_id,
            processing_state_cte.created_at,
            processing_state_cte.applied_at,
            processing_state_cte.interview_score,
            processing_state_cte.processing_status,
            processing_state_cte.bookmarked,
            processing_state_cte.is_new,
            processing_state_cte.status,
            processing_state_cte.badges,
            processing_state_cte.candidate_id,
            processing_state_cte.candidate_file_id,
            processing_state_cte.file_url,
                CASE
                    WHEN (processing_state_cte.resume_processing_state = 'fetching'::resume_processing_state) THEN 'fetching'::resume_processing_state
                    WHEN (processing_state_cte.resume_processing_state = 'unavailable'::resume_processing_state) THEN 'unavailable'::resume_processing_state
                    WHEN COALESCE((recruiter_preferences.scoring <> true), true) THEN 'unscorable'::resume_processing_state
                    ELSE processing_state_cte.resume_processing_state
                END AS resume_processing_state,
                CASE
                    WHEN (processing_state_cte.resume_processing_state = 'fetching'::resume_processing_state) THEN ('-2'::integer)::numeric
                    WHEN (processing_state_cte.resume_processing_state = 'unparsable'::resume_processing_state) THEN ('-3'::integer)::numeric
                    WHEN (processing_state_cte.resume_processing_state = 'unavailable'::resume_processing_state) THEN ('-4'::integer)::numeric
                    WHEN COALESCE((recruiter_preferences.scoring <> true), true) THEN ('-5'::integer)::numeric
                    WHEN ((processing_state_cte.resume_processing_state = 'processed'::resume_processing_state) AND (public_jobs.parameter_weights IS NOT NULL)) THEN ( SELECT score_application(processing_state_cte.scores, public_jobs.parameter_weights) AS score_application)
                    ELSE ('-1'::integer)::numeric
                END AS resume_score
           FROM ((processing_state_cte
             LEFT JOIN public_jobs ON ((public_jobs.id = processing_state_cte.job_id)))
             LEFT JOIN recruiter_preferences ON ((public_jobs.recruiter_id = recruiter_preferences.recruiter_id)))
        )
 SELECT resume_processing_state.id,
    resume_processing_state.job_id,
    resume_processing_state.created_at,
    resume_processing_state.applied_at,
    resume_processing_state.interview_score,
    resume_processing_state.processing_status,
    resume_processing_state.bookmarked,
    resume_processing_state.is_new,
    resume_processing_state.status,
    resume_processing_state.badges,
    resume_processing_state.candidate_id,
    resume_processing_state.candidate_file_id,
    resume_processing_state.file_url,
    resume_processing_state.resume_processing_state,
    resume_processing_state.resume_score,
        CASE
            WHEN (resume_processing_state.resume_score >= (80)::numeric) THEN 'top_match'::application_match
            WHEN ((resume_processing_state.resume_score >= (60)::numeric) AND (resume_processing_state.resume_score < (80)::numeric)) THEN 'good_match'::application_match
            WHEN ((resume_processing_state.resume_score >= (40)::numeric) AND (resume_processing_state.resume_score < (60)::numeric)) THEN 'average_match'::application_match
            WHEN ((resume_processing_state.resume_score >= (20)::numeric) AND (resume_processing_state.resume_score < (40)::numeric)) THEN 'poor_match'::application_match
            WHEN ((resume_processing_state.resume_score >= (0)::numeric) AND (resume_processing_state.resume_score < (20)::numeric)) THEN 'not_a_match'::application_match
            ELSE 'unknown_match'::application_match
        END AS application_match
   FROM resume_processing_state;


create or replace view "public"."application_view" as  WITH application_candidate_cte AS (
         SELECT application_status_view.id,
            application_status_view.job_id,
            application_status_view.created_at,
            application_status_view.applied_at,
            application_status_view.interview_score,
            application_status_view.processing_status,
            application_status_view.bookmarked,
            application_status_view.is_new,
            application_status_view.status,
            application_status_view.badges,
            application_status_view.candidate_id,
            application_status_view.candidate_file_id,
            application_status_view.file_url,
            application_status_view.resume_processing_state,
            application_status_view.resume_score,
            application_status_view.application_match,
            candidates.email,
            TRIM(BOTH FROM (((COALESCE(candidates.first_name, ''::citext))::text || ' '::text) || (COALESCE(candidates.last_name, ''::citext))::text)) AS name,
            candidates.city,
            candidates.linkedin,
            candidates.phone,
            candidates.state,
            candidates.country,
            candidates.current_job_title,
            candidates.timezone
           FROM (application_status_view
             LEFT JOIN candidates ON ((candidates.id = application_status_view.candidate_id)))
        ), meetings_cte AS (
         SELECT interview_meeting.application_id,
            interview_plan.id,
            interview_plan.plan_order,
            interview_plan.name,
            interview_meeting.status,
            interview_session.name AS session_name
           FROM ((interview_session
             JOIN interview_meeting ON ((interview_meeting.id = interview_session.meeting_id)))
             JOIN interview_plan ON ((interview_plan.id = interview_session.interview_plan_id)))
        ), applications_all_meeting_cte AS (
         SELECT application_candidate_cte_1.id AS application_id,
            COALESCE(array_agg(meetings_cte.session_name) FILTER (WHERE (meetings_cte.session_name IS NOT NULL)), ARRAY[]::text[]) AS session_names
           FROM (application_candidate_cte application_candidate_cte_1
             LEFT JOIN meetings_cte ON ((meetings_cte.application_id = application_candidate_cte_1.id)))
          GROUP BY application_candidate_cte_1.id
        ), application_meeting_cte AS (
         SELECT meetings_cte.application_id,
            meetings_cte.id,
            meetings_cte.plan_order,
            meetings_cte.name,
            json_build_object('not_scheduled', count(meetings_cte.status) FILTER (WHERE (meetings_cte.status = 'not_scheduled'::interview_schedule_status)), 'confirmed', count(meetings_cte.status) FILTER (WHERE (meetings_cte.status = 'confirmed'::interview_schedule_status)), 'completed', count(meetings_cte.status) FILTER (WHERE (meetings_cte.status = 'completed'::interview_schedule_status)), 'waiting', count(meetings_cte.status) FILTER (WHERE (meetings_cte.status = 'waiting'::interview_schedule_status)), 'cancelled', count(meetings_cte.status) FILTER (WHERE (meetings_cte.status = 'cancelled'::interview_schedule_status)), 'reschedule', count(meetings_cte.status) FILTER (WHERE (meetings_cte.status = 'reschedule'::interview_schedule_status))) AS status
           FROM meetings_cte
          GROUP BY meetings_cte.application_id, meetings_cte.id, meetings_cte.plan_order, meetings_cte.name
        ), application_plan_cte AS (
         SELECT application_meeting_cte.application_id AS id,
            array_agg(json_build_object('id', application_meeting_cte.id, 'plan_order', application_meeting_cte.plan_order, 'name', application_meeting_cte.name, 'status', application_meeting_cte.status) ORDER BY application_meeting_cte.plan_order) AS interview_plans
           FROM application_meeting_cte
          GROUP BY application_meeting_cte.application_id
        ), application_task_cte AS (
         SELECT application_candidate_cte_1.id,
            COALESCE(count(new_tasks.application_id), (0)::bigint) AS task_count
           FROM (application_candidate_cte application_candidate_cte_1
             LEFT JOIN new_tasks ON ((new_tasks.application_id = application_candidate_cte_1.id)))
          GROUP BY application_candidate_cte_1.id
        ), application_logs_cte AS (
         SELECT application_candidate_cte_1.id,
            COALESCE(count(application_logs.application_id), (0)::bigint) AS activity_count
           FROM (application_candidate_cte application_candidate_cte_1
             LEFT JOIN application_logs ON ((application_logs.application_id = application_candidate_cte_1.id)))
          GROUP BY application_candidate_cte_1.id
        ), application_latest_activity_cte AS (
         SELECT DISTINCT ON (application_logs.application_id) application_logs.application_id,
            application_logs.created_at AS latest_activity
           FROM application_logs
          ORDER BY application_logs.application_id, application_logs.created_at DESC
        )
 SELECT application_candidate_cte.id,
    application_candidate_cte.job_id,
    application_candidate_cte.created_at,
    application_candidate_cte.applied_at,
    application_candidate_cte.resume_score,
    application_candidate_cte.interview_score,
    application_candidate_cte.processing_status,
    application_candidate_cte.bookmarked,
    application_candidate_cte.is_new,
    application_candidate_cte.status,
    application_candidate_cte.badges,
    application_candidate_cte.candidate_file_id,
    application_candidate_cte.email,
    application_candidate_cte.name,
    application_candidate_cte.city,
    application_candidate_cte.linkedin,
    application_candidate_cte.phone,
    application_candidate_cte.state,
    application_candidate_cte.country,
    application_candidate_cte.current_job_title,
    application_candidate_cte.file_url,
    application_candidate_cte.resume_processing_state,
    application_task_cte.task_count,
    application_logs_cte.activity_count,
    application_latest_activity_cte.latest_activity,
    application_candidate_cte.application_match,
    application_candidate_cte.candidate_id,
    application_candidate_cte.timezone,
    applications_all_meeting_cte.session_names,
    COALESCE(application_plan_cte.interview_plans, ARRAY[]::json[]) AS interview_plans
   FROM (((((application_candidate_cte
     LEFT JOIN application_plan_cte ON ((application_plan_cte.id = application_candidate_cte.id)))
     LEFT JOIN application_task_cte ON ((application_task_cte.id = application_candidate_cte.id)))
     LEFT JOIN application_logs_cte ON ((application_logs_cte.id = application_candidate_cte.id)))
     LEFT JOIN application_latest_activity_cte ON ((application_latest_activity_cte.application_id = application_candidate_cte.id)))
     LEFT JOIN applications_all_meeting_cte ON ((applications_all_meeting_cte.application_id = application_candidate_cte.id)));


create or replace view "public"."candidate_applications_view" as  SELECT concat(candidates.first_name, ' ', candidates.last_name) AS candidate_name,
    candidates.id AS candidate_id,
    candidates.email AS candidate_email,
    applications.job_id,
    applications.id AS application_id,
    applications.status AS application_status,
    to_tsvector((((candidates.first_name)::text || ' '::text) || (candidates.last_name)::text)) AS full_text_search,
    public_jobs.job_title AS job_role,
    candidates.recruiter_id AS company_id
   FROM ((applications
     LEFT JOIN candidates ON ((candidates.id = applications.candidate_id)))
     LEFT JOIN public_jobs ON ((public_jobs.id = applications.job_id)));


create or replace view "public"."job_view" as  WITH application_status_view_cte AS (
         SELECT application_status_view.status,
            application_status_view.job_id,
            application_status_view.resume_processing_state,
            application_status_view.application_match
           FROM application_status_view
        ), job_cte AS (
         SELECT public_jobs.created_at,
            public_jobs.department_id,
            departments.name AS department,
            public_jobs.description,
            public_jobs.draft,
            public_jobs.id,
            public_jobs.jd_json,
            public_jobs.job_title,
            public_jobs.job_type,
            public_jobs.location_id,
            row_to_json(office_locations.*) AS location,
            public_jobs.parameter_weights,
            public_jobs.posted_by,
            public_jobs.recruiter_id,
            public_jobs.scoring_criteria_loading,
            public_jobs.status,
            public_jobs.workplace_type,
            public_jobs.hiring_manager,
            public_jobs.recruiter,
            public_jobs.recruiting_coordinator,
            public_jobs.sourcer,
            public_jobs.interview_coordinator,
            public_jobs.interview_plan_warning_ignore,
            public_jobs.interview_session_warning_ignore,
            public_jobs.remote_sync_time,
            public_jobs.is_pinned
           FROM ((public_jobs
             LEFT JOIN departments ON ((departments.id = public_jobs.department_id)))
             LEFT JOIN office_locations ON ((office_locations.id = public_jobs.location_id)))
        ), status_count_default_cte AS (
         SELECT job_cte_1.id,
            defaults.status
           FROM (( SELECT 'new'::text AS status
                UNION
                 SELECT 'interview'::text AS status
                UNION
                 SELECT 'qualified'::text AS status
                UNION
                 SELECT 'disqualified'::text AS status) defaults
             CROSS JOIN job_cte job_cte_1)
        ), status_count_cte AS (
         SELECT status_count_default_cte.id,
            status_count_default_cte.status,
            COALESCE(count(application_status_view_cte.status), (0)::bigint) AS count
           FROM (status_count_default_cte
             LEFT JOIN application_status_view_cte ON (((status_count_default_cte.id = application_status_view_cte.job_id) AND (status_count_default_cte.status = application_status_view_cte.status))))
          GROUP BY status_count_default_cte.id, status_count_default_cte.status
        ), job_section_count_cte AS (
         SELECT status_count_cte.id,
            json_object_agg(status_count_cte.status, status_count_cte.count) AS section_count
           FROM status_count_cte
          GROUP BY status_count_cte.id
        ), application_match_default_cte AS (
         SELECT job_cte_1.id,
            defaults.application_match
           FROM (( SELECT 'top_match'::application_match AS application_match
                UNION
                 SELECT 'good_match'::application_match AS application_match
                UNION
                 SELECT 'average_match'::application_match AS application_match
                UNION
                 SELECT 'poor_match'::application_match AS application_match
                UNION
                 SELECT 'not_a_match'::application_match AS application_match
                UNION
                 SELECT 'unknown_match'::application_match AS application_match) defaults
             CROSS JOIN job_cte job_cte_1)
        ), application_match_cte AS (
         SELECT application_match_default_cte.id,
            application_match_default_cte.application_match,
            COALESCE(count(application_status_view_cte.application_match), (0)::bigint) AS count
           FROM (application_match_default_cte
             LEFT JOIN application_status_view_cte ON (((application_match_default_cte.id = application_status_view_cte.job_id) AND (application_match_default_cte.application_match = application_status_view_cte.application_match))))
          GROUP BY application_match_default_cte.id, application_match_default_cte.application_match
        ), job_application_match_cte AS (
         SELECT application_match_cte.id,
            json_object_agg(application_match_cte.application_match, application_match_cte.count) AS application_match
           FROM application_match_cte
          GROUP BY application_match_cte.id
        ), processing_count_default_cte AS (
         SELECT job_cte_1.id,
            defaults.resume_processing_state
           FROM (( SELECT 'fetching'::resume_processing_state AS resume_processing_state
                UNION
                 SELECT 'unavailable'::resume_processing_state AS resume_processing_state
                UNION
                 SELECT 'processing'::resume_processing_state AS resume_processing_state
                UNION
                 SELECT 'processed'::resume_processing_state AS resume_processing_state
                UNION
                 SELECT 'unparsable'::resume_processing_state AS resume_processing_state
                UNION
                 SELECT 'unscorable'::resume_processing_state AS resume_processing_state) defaults
             CROSS JOIN job_cte job_cte_1)
        ), processing_count_cte AS (
         SELECT processing_count_default_cte.id,
            processing_count_default_cte.resume_processing_state,
            COALESCE(count(application_status_view_cte.resume_processing_state), (0)::bigint) AS count
           FROM (processing_count_default_cte
             LEFT JOIN application_status_view_cte ON (((processing_count_default_cte.id = application_status_view_cte.job_id) AND (processing_count_default_cte.resume_processing_state = application_status_view_cte.resume_processing_state))))
          GROUP BY processing_count_default_cte.id, processing_count_default_cte.resume_processing_state
        ), job_processing_count_cte AS (
         SELECT processing_count_cte.id,
            json_object_agg(processing_count_cte.resume_processing_state, processing_count_cte.count) AS processing_count
           FROM processing_count_cte
          GROUP BY processing_count_cte.id
        )
 SELECT job_cte.created_at,
    job_cte.department_id,
    job_cte.department,
    job_cte.description,
    job_cte.draft,
    job_cte.id,
    job_cte.jd_json,
    job_cte.job_title,
    job_cte.job_type,
    job_cte.location_id,
    job_cte.location,
    job_cte.parameter_weights,
    job_cte.posted_by,
    job_cte.recruiter_id,
    job_cte.scoring_criteria_loading,
    job_cte.status,
    job_cte.workplace_type,
    job_cte.hiring_manager,
    job_cte.recruiter,
    job_cte.recruiting_coordinator,
    job_cte.sourcer,
    job_cte.interview_coordinator,
    job_cte.interview_plan_warning_ignore,
    job_cte.interview_session_warning_ignore,
    job_cte.remote_sync_time,
    job_section_count_cte.section_count,
    job_processing_count_cte.processing_count,
    job_application_match_cte.application_match,
    job_cte.is_pinned
   FROM (((job_cte
     LEFT JOIN job_section_count_cte ON ((job_section_count_cte.id = job_cte.id)))
     LEFT JOIN job_processing_count_cte ON ((job_processing_count_cte.id = job_cte.id)))
     LEFT JOIN job_application_match_cte ON ((job_application_match_cte.id = job_cte.id)));


create or replace view "public"."meeting_details" as  SELECT interview_meeting.id,
    interview_meeting.created_at,
    interview_meeting.meeting_json,
    interview_meeting.status,
    interview_meeting.instructions,
    interview_meeting.meeting_link,
    interview_meeting.confirmed_date,
    interview_meeting.start_time,
    interview_meeting.end_time,
    interview_meeting.cal_event_id,
    interview_meeting.candidate_feedback,
    interview_meeting.organizer_id,
    interview_session.id AS session_id,
    interview_session.name AS session_name,
    interview_session.break_duration,
    interview_session.session_order,
    interview_session.session_duration,
    interview_session.session_type,
    interview_session.schedule_type,
    interview_meeting.application_id,
    interview_meeting.meeting_flow,
    applications.job_id,
    public_jobs.recruiter_id,
    interview_session.module_id,
    ( SELECT array_agg(
                CASE
                    WHEN (interview_session.session_type = 'debrief'::session_type) THEN debrief_user.user_id
                    ELSE recruiter_user.user_id
                END) AS array_agg
           FROM (((interview_session_relation
             LEFT JOIN interview_module_relation ON ((interview_session_relation.interview_module_relation_id = interview_module_relation.id)))
             LEFT JOIN recruiter_user ON ((recruiter_user.user_id = interview_module_relation.user_id)))
             LEFT JOIN recruiter_user debrief_user ON ((debrief_user.user_id = interview_session_relation.user_id)))
          WHERE ((interview_session_relation.session_id = interview_session.id) AND (interview_session_relation.is_confirmed = true))) AS confirmed_user_ids,
    ( SELECT array_agg(interview_module_relation.id) AS array_agg
           FROM (interview_session_relation
             LEFT JOIN interview_module_relation ON ((interview_session_relation.interview_module_relation_id = interview_module_relation.id)))
          WHERE ((interview_session_relation.session_id = interview_session.id) AND (interview_session_relation.is_confirmed = true))) AS confirmed_module_relation_ids,
    interview_session.parent_session_id,
    interview_meeting.schedule_request_id,
    interview_meeting.confirmed_candidate_tz
   FROM (((interview_meeting
     LEFT JOIN interview_session ON ((interview_meeting.id = interview_session.meeting_id)))
     LEFT JOIN applications ON ((applications.id = interview_meeting.application_id)))
     LEFT JOIN public_jobs ON ((applications.job_id = public_jobs.id)));


create or replace view "public"."meeting_interviewers" as  WITH interview_data AS (
         SELECT interview_session_relation.id AS session_relation_id,
            interview_session_relation.interviewer_type,
            interview_session_relation.training_type,
            interview_session_relation.is_confirmed,
            interview_session.meeting_id,
            interview_session.id AS session_id,
            interview_session.session_type,
            interview_meeting.end_time,
            interview_meeting.start_time,
            interview_meeting.status,
            interview_session.session_duration,
            COALESCE(debrief_user.first_name, recruiter_user.first_name) AS first_name,
            COALESCE(debrief_user.last_name, recruiter_user.last_name) AS last_name,
            COALESCE(debrief_user.profile_image, recruiter_user.profile_image) AS profile_image,
            COALESCE(debrief_user.email, recruiter_user.email) AS email,
            COALESCE(debrief_user.user_id, recruiter_user.user_id) AS user_id,
            COALESCE(((debrief_user.scheduling_settings -> 'timeZone'::text) ->> 'tzCode'::text), ((recruiter_user.scheduling_settings -> 'timeZone'::text) ->> 'tzCode'::text)) AS tz_code,
            COALESCE(debrief_user."position", recruiter_user."position") AS "position",
            interview_session_relation.accepted_status,
            ( SELECT json_agg(row_to_json(interview_session_cancel.*)) AS json_agg
                   FROM interview_session_cancel
                  WHERE (interview_session_cancel.session_relation_id = interview_session_relation.id)) AS cancel_reasons,
            interview_session_relation.interview_module_relation_id,
            interview_module_relation.module_id,
                CASE
                    WHEN (interview_session.interview_plan_id IS NOT NULL) THEN interview_plan.job_id
                    ELSE applications.job_id
                END AS job_id,
            COALESCE(debrief_user.schedule_auth, recruiter_user.schedule_auth) AS schedule_auth,
            COALESCE(debrief_user.scheduling_settings, recruiter_user.scheduling_settings) AS scheduling_settings
           FROM (((((((interview_session_relation
             LEFT JOIN interview_module_relation ON ((interview_session_relation.interview_module_relation_id = interview_module_relation.id)))
             LEFT JOIN interview_session ON ((interview_session.id = interview_session_relation.session_id)))
             LEFT JOIN interview_meeting ON ((interview_meeting.id = interview_session.meeting_id)))
             LEFT JOIN interview_plan ON ((interview_plan.id = interview_session.interview_plan_id)))
             LEFT JOIN applications ON ((applications.id = interview_meeting.application_id)))
             LEFT JOIN recruiter_user ON ((recruiter_user.user_id = interview_module_relation.user_id)))
             LEFT JOIN recruiter_user debrief_user ON ((debrief_user.user_id = interview_session_relation.user_id)))
        ), time_boundaries AS (
         SELECT CURRENT_DATE AS today_start,
            ((CURRENT_DATE + '1 day'::interval) - '00:00:01'::interval) AS today_end,
            (date_trunc('week'::text, (CURRENT_DATE)::timestamp with time zone) + '1 day'::interval) AS week_start,
            ((date_trunc('week'::text, (CURRENT_DATE)::timestamp with time zone) + '7 days'::interval) - '00:00:01'::interval) AS week_end
        )
 SELECT interview_data.session_relation_id,
    interview_data.interviewer_type,
    interview_data.training_type,
    interview_data.is_confirmed,
    interview_data.meeting_id,
    interview_data.session_id,
    interview_data.session_type,
    interview_data.first_name,
    interview_data.last_name,
    interview_data.profile_image,
    interview_data.email,
    interview_data.user_id,
    interview_data.tz_code,
    interview_data."position",
    ( SELECT count(*) AS count
           FROM interview_data id2,
            time_boundaries tb
          WHERE ((id2.user_id = interview_data.user_id) AND (id2.end_time >= tb.today_start) AND (id2.end_time <= tb.today_end) AND (id2.is_confirmed = true) AND ((id2.status = 'confirmed'::interview_schedule_status) OR (id2.status = 'completed'::interview_schedule_status)))) AS totalinterviewstoday,
    ( SELECT count(*) AS count
           FROM interview_data id3,
            time_boundaries tb
          WHERE ((id3.user_id = interview_data.user_id) AND (id3.start_time >= tb.week_start) AND (id3.end_time <= tb.week_end) AND (id3.is_confirmed = true) AND ((id3.status = 'confirmed'::interview_schedule_status) OR (id3.status = 'completed'::interview_schedule_status)))) AS totalinterviewsthisweek,
    ( SELECT (COALESCE(sum(id4.session_duration), (0)::numeric) / 60.0)
           FROM interview_data id4,
            time_boundaries tb
          WHERE ((id4.user_id = interview_data.user_id) AND (id4.end_time >= tb.today_start) AND (id4.end_time <= tb.today_end) AND (id4.is_confirmed = true) AND ((id4.status = 'confirmed'::interview_schedule_status) OR (id4.status = 'completed'::interview_schedule_status)))) AS totalhourstoday,
    ( SELECT (COALESCE(sum(id5.session_duration), (0)::numeric) / 60.0)
           FROM interview_data id5,
            time_boundaries tb
          WHERE ((id5.user_id = interview_data.user_id) AND (id5.start_time >= tb.week_start) AND (id5.end_time <= tb.week_end) AND (id5.is_confirmed = true) AND ((id5.status = 'confirmed'::interview_schedule_status) OR (id5.status = 'completed'::interview_schedule_status)))) AS totalhoursthisweek,
    interview_data.accepted_status,
    interview_data.cancel_reasons,
    interview_data.interview_module_relation_id,
    interview_data.module_id,
    interview_data.job_id,
    interview_data.schedule_auth,
    interview_data.scheduling_settings
   FROM interview_data;


create or replace view "public"."tasks_view" as  WITH interview_session_cte AS (
         SELECT interview_session.id,
            interview_session.session_type,
            interview_session.name,
            interview_session.session_order,
                CASE
                    WHEN (interview_meeting.id IS NOT NULL) THEN json_build_object('id', interview_meeting.id, 'start_time', interview_meeting.start_time, 'end_time', interview_meeting.end_time, 'meeting_link', interview_meeting.meeting_link)
                    ELSE NULL::json
                END AS interview_meeting
           FROM (interview_session
             LEFT JOIN interview_meeting ON ((interview_meeting.id = interview_session.meeting_id)))
        ), session_interviewers_cte AS (
         SELECT interview_session_cte.id,
            json_agg(
                CASE
                    WHEN (meeting_interviewers.session_id IS NOT NULL) THEN json_build_object('email', meeting_interviewers.email, 'user_id', meeting_interviewers.user_id, 'last_name', meeting_interviewers.last_name, 'first_name', meeting_interviewers.first_name, 'profile_image', meeting_interviewers.profile_image, 'training_type', meeting_interviewers.training_type, 'interviewer_type', meeting_interviewers.interviewer_type, 'is_confirmed', meeting_interviewers.is_confirmed)
                    ELSE NULL::json
                END) AS users
           FROM (interview_session_cte
             LEFT JOIN meeting_interviewers ON ((meeting_interviewers.session_id = interview_session_cte.id)))
          WHERE (meeting_interviewers.is_confirmed = true)
          GROUP BY interview_session_cte.id
        ), session_ids AS (
         SELECT interview_session_cte.id,
            interview_session_cte.session_type,
            interview_session_cte.name,
            interview_session_cte.session_order,
            interview_session_cte.interview_meeting,
            COALESCE(session_interviewers_cte.users, '[]'::json) AS users
           FROM (interview_session_cte
             LEFT JOIN session_interviewers_cte ON ((session_interviewers_cte.id = interview_session_cte.id)))
        ), task_session_ids_cte AS (
         SELECT task_session_relation.task_id,
            COALESCE(json_agg(session_ids.*) FILTER (WHERE (session_ids.id IS NOT NULL)), '[]'::json) AS session_ids
           FROM (task_session_relation
             LEFT JOIN session_ids ON ((session_ids.id = task_session_relation.session_id)))
          GROUP BY task_session_relation.task_id
        ), task_progress_cte AS (
         SELECT DISTINCT ON (new_tasks_progress.task_id) new_tasks_progress.task_id,
            json_build_object('id', new_tasks_progress.id, 'progress_type', new_tasks_progress.progress_type, 'created_at', new_tasks_progress.created_at, 'created_by', new_tasks_progress.created_by, 'jsonb_data', new_tasks_progress.jsonb_data, 'title_meta', new_tasks_progress.title_meta) AS latest_progress,
            new_tasks_progress.created_at
           FROM new_tasks_progress
          ORDER BY new_tasks_progress.task_id, new_tasks_progress.created_at DESC
        )
 SELECT new_tasks.id,
    new_tasks.created_at,
    new_tasks.name,
    new_tasks.due_date,
    new_tasks.assignee,
    new_tasks.start_date,
    new_tasks.application_id,
    new_tasks.recruiter_id,
    new_tasks.schedule_date_range,
    new_tasks.created_by,
    new_tasks.type,
    new_tasks.status,
    new_tasks.agent,
    new_tasks.filter_id,
    new_tasks.priority,
    new_tasks.task_owner,
    new_tasks.trigger_count,
    new_tasks.task_action,
    new_tasks.request_availability_id,
    COALESCE(task_session_ids_cte.session_ids, '[]'::json) AS session_ids,
    task_progress_cte.latest_progress
   FROM ((new_tasks
     LEFT JOIN task_session_ids_cte ON ((task_session_ids_cte.task_id = new_tasks.id)))
     LEFT JOIN task_progress_cte ON ((task_progress_cte.task_id = new_tasks.id)));


create or replace view "public"."workflow_view" as  WITH job_cte AS (
         SELECT workflow_job_relation.workflow_id,
            array_agg(json_build_object('id', workflow_job_relation.job_id, 'job_title', public_jobs.job_title, 'department', departments.name, 'location', row_to_json(office_locations.*), 'status', public_jobs.status)) AS jobs
           FROM (((workflow_job_relation
             LEFT JOIN public_jobs ON ((workflow_job_relation.job_id = public_jobs.id)))
             LEFT JOIN departments ON ((departments.id = public_jobs.department_id)))
             LEFT JOIN office_locations ON ((office_locations.id = public_jobs.location_id)))
          WHERE (public_jobs.status <> 'closed'::public_job_status)
          GROUP BY workflow_job_relation.workflow_id
        ), action_cte AS (
         SELECT workflow_action.workflow_id,
            COALESCE(array_agg(DISTINCT
                CASE
                    WHEN ((workflow_action.action_type = 'end_point'::text) OR (workflow_action.action_type = 'agent_instruction'::text)) THEN 'system'::text
                    ELSE workflow_action.action_type
                END), ARRAY[]::text[]) AS tags
           FROM workflow_action
          GROUP BY workflow_action.workflow_id
        )
 SELECT workflow.id,
    workflow.created_at,
    workflow.trigger,
    workflow.phase,
    workflow."interval",
    workflow.title,
    workflow.recruiter_id,
    workflow.auto_connect,
    workflow.description,
    COALESCE(job_cte.jobs, ARRAY[]::json[]) AS jobs,
    workflow.workflow_type,
    workflow.is_paused,
    array_append(action_cte.tags, (workflow.trigger)::text) AS tags,
    workflow.request_id
   FROM ((workflow
     LEFT JOIN job_cte ON ((job_cte.workflow_id = workflow.id)))
     LEFT JOIN action_cte ON ((action_cte.workflow_id = workflow.id)));



